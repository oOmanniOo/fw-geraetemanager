{% extends "base.html" %}
{% block content %}
<h2>Prüfungsübersicht</h2>

<!-- Filter-Bereich -->
<div class="filter-section">
    <h3>Filter</h3>
    <form method="get">
        <div>
            <label for="geraet">Gerät:</label>
            <input type="text" id="geraet" name="geraet" value="{{ request.GET.geraet }}" placeholder="Gerätename eingeben">
        </div>
        <div>
            <label for="art">Prüfungsart:</label>
            <select id="art" name="art">
                <option value="">Alle Arten</option>
                {% for art in arten %}
                <option value="{{ art.name }}" {% if request.GET.art == art.name %}selected{% endif %}>{{ art.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label for="bestanden">Status:</label>
            <select id="bestanden" name="bestanden">
                <option value="">Alle</option>
                <option value="true" {% if request.GET.bestanden == 'true' %}selected{% endif %}>Bestanden</option>
                <option value="false" {% if request.GET.bestanden == 'false' %}selected{% endif %}>Nicht bestanden</option>
            </select>
        </div>
        <div>
            <button type="submit">Filtern</button>
            <a href="{% url 'pruefungen:pruefungs_uebersicht' %}">Zurücksetzen</a>
        </div>
    </form>
</div>

<!-- Prüfungsliste -->
<div class="pruefungs-liste">
    {% if pruefungen %}
    <table class="table table-striped m-4 ">
        <thead>
            <tr>
                <th>Datum</th>
                <th>Gerät</th>
                <th>Prüfungsart</th>
                <th>Prüfer</th>
                <th>Status</th>
                <th>Aktionen</th>
            </tr>
        </thead>
        <tbody>
            {% for pruefung in pruefungen %}
            <tr>
                <td>{{ pruefung.datum|date:"d.m.Y" }}</td>
                <td>
                    <a href="{% url 'geraete:geraete_detail' pruefung.geraet.pk %}">{{ pruefung.geraet.bezeichnung }}</a>
                </td>
                <td>{{ pruefung.art.name }}</td>
                <td>{{ pruefung.pruefer }}</td>
                <td>
                    {% if pruefung.bestanden %}
                    <span>✓ Bestanden</span>
                    {% else %}
                    <span>✗ Nicht bestanden</span>
                    {% endif %}
                </td>
                <td>
                    <a href="{% url 'pruefungen:bearbeite_pruefung' pruefung.pk %}">Bearbeiten</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <!-- Zusammenfassung -->
    <div>
        <h4>Zusammenfassung</h4>
        <p><strong>Gesamtanzahl Prüfungen:</strong> {{ pruefungen.count }}</p>
        <p><strong>Bestanden:</strong> {{ pruefungen|dictsort:"bestanden"|length }}</p>
        <p><strong>Nicht bestanden:</strong> {{ pruefungen|dictsort:"bestanden"|length }}</p>
    </div>
    
    {% else %}
    <p>Keine Prüfungen gefunden.</p>
    {% endif %}
</div>
{% endblock %}